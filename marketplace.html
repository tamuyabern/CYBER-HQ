<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HQ Marketplace</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f4f4; }
    header { background:#222; color:#fff; padding:15px; text-align:center; }
    .container { padding:20px; }

    /* Search bar */
    #searchBar {
      width:100%; padding:10px; border:1px solid #ccc;
      border-radius:5px; margin-bottom:15px; font-size:16px;
    }

    /* Product grid */
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:15px; }
    .card {
      background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.15);
      overflow:hidden; cursor:pointer; transition:0.2s;
    }
    .card:hover { transform:scale(1.02); }
    .card img { width:100%; height:180px; object-fit:cover; }
    .card-body { padding:10px; }
    .card-body h3 { margin:5px 0; font-size:18px; }
    .price { color:green; font-weight:bold; }

    /* Floating add button */
    .fab {
      position:fixed; bottom:20px; right:20px;
      width:60px; height:60px; border-radius:50%;
      background:#ff5722; color:#fff; font-size:32px;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 4px 10px rgba(0,0,0,0.3); cursor:pointer;
    }

    /* Modal */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.6); align-items:center; justify-content:center; z-index:999; }
    .modal-content {
      background:#fff; padding:20px; border-radius:10px; width:90%; max-width:500px; max-height:90%; overflow-y:auto;
      position:relative;
    }
    .modal-content h2 { margin-top:0; }
    .close { position:absolute; top:10px; right:15px; font-size:24px; cursor:pointer; }

    /* Carousel */
    .carousel { display:flex; overflow-x:auto; gap:10px; scroll-snap-type:x mandatory; }
    .carousel img {
      width:100%; max-width:450px; border-radius:10px; scroll-snap-align:center;
    }

    .form-group { margin-bottom:10px; }
    .form-group input, .form-group textarea, .form-group select {
      width:100%; padding:8px; border:1px solid #ccc; border-radius:5px;
    }
    button {
      background:#ff5722; color:#fff; border:none; padding:10px 20px;
      border-radius:5px; cursor:pointer; font-size:16px;
    }
    button:hover { background:#e64a19; }
  </style>
</head>
<body>
<header><h1>HQ Marketplace</h1></header>

<div class="container">
  <!-- Search -->
  <input type="text" id="searchBar" placeholder="Search products by name, category, or specs...">

  <!-- Product grid -->
  <div id="products" class="grid"></div>
</div>

<!-- Floating Add Button -->
<div class="fab" onclick="openPostModal()">+</div>

<!-- Post Product Modal -->
<div class="modal" id="postModal">
  <div class="modal-content">
    <span class="close" onclick="closePostModal()">&times;</span>
    <h2>Add Product</h2>
    <form id="postForm">
      <div class="form-group"><input type="text" id="pname" placeholder="Product name" required></div>
      <div class="form-group"><input type="number" id="pprice" placeholder="Price" required></div>
      <div class="form-group"><textarea id="pdesc" placeholder="Description" required></textarea></div>
      <div class="form-group"><textarea id="pspecs" placeholder="Specifications"></textarea></div>
      <div class="form-group">
        <select id="pcategory">
          <option>Electronics</option>
          <option>Phones</option>
          <option>Computers</option>
          <option>Home</option>
        </select>
      </div>
      <div class="form-group"><input type="text" id="pregion" placeholder="Region/Location" required></div>
      <div class="form-group"><input type="tel" id="pphone" placeholder="Phone number" required></div>
      <div class="form-group"><input type="file" id="pimages" multiple accept="image/*"></div>
      <button type="submit">Post</button>
    </form>
  </div>
</div>

<!-- Product Detail Modal -->
<div class="modal" id="detailModal">
  <div class="modal-content">
    <span class="close" id="detailCloseBtn">&times;</span>
    <div id="detailBody"></div>
  </div>
</div>

<script>
  let products = [];

  // Dummy data (replace with Firestore snapshot)
  products = [
    { name:"iPhone 13", price:75000, description:"Like new, 128GB", specs:"iOS, 128GB", category:"Phones", region:"Nairobi", phone:"0712345678",
      images:["https://via.placeholder.com/450x300?text=iPhone1","https://via.placeholder.com/450x300?text=iPhone2"] },
    { name:"Dell Laptop", price:45000, description:"Core i5, 8GB RAM", specs:"Windows 10, SSD", category:"Computers", region:"Eldoret", phone:"0722334455",
      images:["https://via.placeholder.com/450x300?text=Laptop1"] }
  ];

  const grid = document.getElementById("products");

  function displayProducts(list){
    grid.innerHTML = "";
    if(list.length===0){ grid.innerHTML="<p>No products found.</p>"; return; }
    list.forEach((p,idx)=>{
      const div=document.createElement("div");
      div.className="card";
      div.dataset.index=idx;
      div.onclick=()=>showDetail(p);
      div.innerHTML=`
        <img src="${p.images[0] || 'https://via.placeholder.com/450x300'}" alt="${p.name}">
        <div class="card-body">
          <h3>${p.name}</h3>
          <p class="price">Ksh ${p.price}</p>
          <p>${p.region}</p>
        </div>`;
      grid.appendChild(div);
    });
  }

  function showDetail(p){
    const imgs = p.images.map(url=>`<img src="${url}" alt="${p.name}">`).join("");
    document.getElementById("detailBody").innerHTML=`
      <h2>${p.name}</h2>
      <div class="carousel">${imgs}</div>
      <p><b>Price:</b> <span class="price">Ksh ${p.price}</span></p>
      <p><b>Description:</b> ${p.description}</p>
      <p><b>Specs:</b> ${p.specs}</p>
      <p><b>Category:</b> ${p.category}</p>
      <p><b>Location:</b> ${p.region}</p>
      <a href="tel:${p.phone}">ðŸ“ž ${p.phone}</a>
    `;
    document.getElementById("detailModal").style.display="flex";
  }

  function closeDetail(){ document.getElementById("detailModal").style.display="none"; }
  document.getElementById("detailCloseBtn").onclick=closeDetail;

  function openPostModal(){ document.getElementById("postModal").style.display="flex"; }
  function closePostModal(){ document.getElementById("postModal").style.display="none"; }

  // Search filter
  document.getElementById("searchBar").addEventListener("input", function(){
    const q=this.value.toLowerCase();
    const filtered=products.filter(p=>
      p.name.toLowerCase().includes(q) ||
      p.category.toLowerCase().includes(q) ||
      p.specs.toLowerCase().includes(q)
    );
    displayProducts(filtered);
  });

  // Handle post form (local simulation)
  document.getElementById("postForm").addEventListener("submit", e=>{
    e.preventDefault();
    const newProduct = {
      name:document.getElementById("pname").value,
      price:document.getElementById("pprice").value,
      description:document.getElementById("pdesc").value,
      specs:document.getElementById("pspecs").value,
      category:document.getElementById("pcategory").value,
      region:document.getElementById("pregion").value,
      phone:document.getElementById("pphone").value,
      images:[]
    };

    const files=document.getElementById("pimages").files;
    for(let i=0;i<files.length;i++){
      newProduct.images.push(URL.createObjectURL(files[i])); // preview only
    }

    products.unshift(newProduct);
    displayProducts(products);
    closePostModal();
    e.target.reset();
  });

  displayProducts(products);
</script>
</body>
</html>
